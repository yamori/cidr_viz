<!-- views/pages/index.ejs -->

<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../partials/head %>
</head>

<body>

    <header>
        <% include ../partials/header %>
    </header>

    <div class="container">
        <div class="row">
            <div class="col-5">
                <form>
                    <div class="form-group">
                        <input id="user_input_account" class="form-control" type="text" placeholder="(account CIDR here)">
                    </div>
                    <div class="form-group">
                        <textarea id="user_input_cidr" class="form-control" aria-label="With textarea" rows="5" placeholder="10.82.208.0/20 (entire account)&#10; (subsequent lines are sub-blocks)&#10;10.82.218.0/24&#10;10.82.208.0/24 (order doesn't matter)&#10; (try some 'examples' below!)"></textarea>
                    </div>
                    <div class="form-group">
                        <button id="blah" class="btn btn-primary">Submit</button>
                        <button id="insertExamplesButton" class="btn btn-primary" onclick "insertExample();">Insert Example</button>
                        <button id="clearInputButton" class="btn btn-primary" onclick "insertExample();">Clear</button>
                    </div>
                </form>
                <div class="input-group">
                    <input id="user_input_account" class="form-control" type="text" placeholder="(account CIDR here)">
                    <textarea id="user_input_cidr" class="form-control" aria-label="With textarea" rows="5" placeholder="10.82.208.0/20 (entire account)&#10; (subsequent lines are sub-blocks)&#10;10.82.218.0/24&#10;10.82.208.0/24 (order doesn't matter)&#10; (try some 'examples' below!)"></textarea>
                </div>
                <button id="blah" class="btn btn-primary">Submit</button>
                <button id="insertExamplesButton" class="btn btn-primary" onclick "insertExample();">Insert Example</button>
                <button id="clearInputButton" class="btn btn-primary" onclick "insertExample();">Clear</button>
            </div>


            <div id="results_div" class="col-7">
                <h4>Account</h4>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th scope="col">CIDR</th>
                            <th scope="col"># IPs</th>
                            <th scope="col">First</th>
                            <th scope="col">Last</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>10.82.208.0/20</td>
                            <td>64</td>
                            <td>10.82.208.0/20</td>
                            <td>10.82.208.0/20</td>
                        </tr>
                    </tbody>
                </table>
                <h4>Lowest CIDR Blocking</h4>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th scope="col">CIDR</th>
                            <th scope="col"># IPs</th>
                            <th scope="col">First</th>
                            <th scope="col">Last</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>10.82.208.0/20</td>
                            <td>64</td>
                            <td>10.82.208.0/20</td>
                            <td>10.82.208.0/20</td>
                        </tr>
                        <tr>
                            <td>10.82.208.0/20</td>
                            <td>64</td>
                            <td>10.82.208.0/20</td>
                            <td>10.82.208.0/20</td>
                        </tr>
                        <tr>
                            <td>10.82.208.0/20</td>
                            <td>64</td>
                            <td>10.82.208.0/20</td>
                            <td>10.82.208.0/20</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>



    <footer>
        <% include ../partials/footer %>
    </footer>

    <script>
        $(document).ready(function () {
            $("#blah").click(function () {
                userInputForm = $('#user_input_cidr').val();
                $.ajax({
                    url: window.location + "do_cidr/",
                    type: "POST",
                    data: JSON.stringify({ userInput: userInputForm }),
                    dataType: "html",
                    contentType: "application/json; charset=utf-8",
                    success: function (response, status, http) {
                        $("#results_div").html(response);
                    },
                    error: function (error) {
                        alert('hmm, something went wrong');
                        // ... something unspecified.
                    }
                });
            });
        });

        var insertedExampleIndex = -1;
        var exampleBank = ['10.82.208.0/20\n10.82.217.128/27\n10.82.219.0/24', '192.168.100.14/24', '10.1.0.0/20\n10.1.2.0/24\n10.1.7.0/28'];
        function insertExample() {
            var newIndex = Math.floor(Math.random() * exampleBank.length);
            while (newIndex == insertedExampleIndex) {
                // Don't display the same example consecutively
                newIndex = Math.floor(Math.random() * exampleBank.length);
            }
            insertedExampleIndex = newIndex;
            $('#user_input_cidr').val(exampleBank[insertedExampleIndex]);
        }
        $('#insertExamplesButton').on('click', function (event) {
            event.preventDefault(); // To prevent following the link (optional)
            insertExample();
        });

        // Clear the input button
        $('#clearInputButton').on('click', function (event) {
            event.preventDefault(); // To prevent following the link (optional)
            $('#user_input_cidr').val('');
        });
    </script>

</body>

</html>